components:
  schemas:
    OrderResponse:
      type: object
      properties:
        id:
          type: string
          description: The auto-generated id of the order
        customerId:
          type: string
          description: ID of the customer (denormalized for authorization)
        status:
          type: string
          description: Current status of the order
        address:
          $ref: '#/components/schemas/Address'
          description: Shipping address
        phoneNumber:
          type: string
          description: Contact phone number
        pointsRedeemed:
          type: number
          description: Loyalty points redeemed for this order
        pointsEarned:
          type: number
          description: Loyalty points earned from this order
        price:
          type: number
          description: Total order price
        products:
          type: array
          items:
            $ref: '#/components/schemas/OrderProduct'
        payment:
          $ref: '#/components/schemas/Payment'
          description: Payment details
        shipment:
          $ref: '#/components/schemas/Shipment'
          description: Shipment details
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    OrderProduct:
      type: object
      properties:
        variantId:
          type: string
        productId:
          type: string
        quantity:
          type: number
        colors:
          type: array
          items:
            type: string
        productName:
          type: string
        brandName:
          type: string
        size:
          type: string
        price:
          type: number
        imageURL:
          type: string

    OrderRequest:
      type: object
      required:
        - products
      properties:
        products:
          type: array
          items:
            type: object
            required:
              - variantId
              - productId
              - quantity
            properties:
              variantId:
                type: string
              productId:
                type: string
              quantity:
                type: number

    OrderConfirmRequest:
      type: object
      required:
        - address
        - phoneNumber
        - payment
      properties:
        address:
          $ref: '#/components/schemas/Address'
        phoneNumber:
          type: string
        pointsRedeemed:
          type: number
        payment:
          $ref: '#/components/schemas/PaymentRequest'

    Payment:
      type: object
      properties:
        method:
          type: string
        credentials:
          type: string

    PaymentRequest:
      type: object
      required:
        - method
      properties:
        method:
          type: string
        credentials:
          type: string

    Shipment:
      type: object
      properties:
        createdAt:
          type: string
          format: date-time
        deliveredAt:
          type: string
          format: date-time
        fees:
          type: number
        method:
          type: string
        trackingNumber:
          type: string
        carrier:
          type: string

    ShipmentRequest:
      type: object
      required:
        - method
      properties:
        method:
          type: string

    OrderStatusUpdate:
      type: object
      required:
        - status
      properties:
        status:
          type: string
        deliveredAt:
          type: string
          format: date-time

    SuccessResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        message:
          type: string
        data:
          type: object

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        message:
          type: string

paths:
  /orders:
    get:
      summary: Retrieve all orders (admin/staff only) - Searching by productId not implemented yet!
      tags: [Orders]
      parameters:
        - in: query
          name: status
          schema:
            type: string
            description: Filter orders by status
        - in: query
          name: productId
          schema:
            type: string
            description: Filter orders by productId
        - in: query
          name: page
          schema:
            type: integer
            description: Page number for pagination
      responses:
        200:
          description: A list of orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  count:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderResponse'
                  pagination:
                    $ref: "#/components/schemas/PaginationInfo"
        401:
          description: Unauthorized - Invalid or missing token
        403:
          description: Forbidden - Insufficient permissions
        500:
          description: Server error

  /orders/{id}:
    delete:
      summary: Delete an order (admin/staff only)
      tags: [Orders]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        204:
          description: Order deleted successfully
        401:
          description: Unauthorized - Invalid or missing token
        403:
          description: Forbidden - Insufficient permissions
        404:
          description: Order not found
        500:
          description: Server error

  /customers/me/orders:
    get:
      summary: Get orders for the authenticated customer
      tags: [Orders]
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            description: Page number for pagination
      responses:
        200:
          description: List of customer's orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderResponse'
                  pagination:
                    $ref: "#/components/schemas/PaginationInfo"
        401:
          description: Unauthorized - Invalid or missing token
        500:
          description: Server error
    post:
      summary: Create a new order for the authenticated customer (Checkout in the Cart Screen)
      tags: [Orders]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderRequest'
      responses:
        201:
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        400:
          description: Invalid input
        401:
          description: Unauthorized - Invalid or missing token
        500:
          description: Server error

  /customers/me/orders/{id}:
    get:
      summary: Get a specific order for the authenticated customer
      tags: [Orders]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        401:
          description: Unauthorized - Invalid or missing token
        403:
          description: Forbidden - Insufficient permissions
        404:
          description: Order not found
        500:
          description: Server error
    
  /customers/me/orders/{id}/confirm:
    put:
      summary: Confirm an order (Place an order in the Checkout screen) of the authenticated customer
      tags: [Orders]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderConfirmRequest'
      responses:
        200:
          description: Order confirmed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        400:
          description: Invalid input
        401:
          description: Unauthorized - Invalid or missing token
        403:
          description: Forbidden - Insufficient permissions
        404:
          description: Order not found
        500:
          description: Server error
  
  /customers/me/orders/{id}/cancel:
    patch:
      summary: Cancel an order of the authenticated customer
      tags: [Orders]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: Order cancelled successfully
        400:
          description: Invalid input
        401:
          description: Unauthorized - Invalid or missing token
        403:
          description: Forbidden - Insufficient permissions
        404:
          description: Order not found
        500:
          description: Server error

  /customers/me/orders/{id}/refund:
    patch:
      summary: Refund an order of the authenticated customer
      tags: [Orders]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: Order refunded successfully
        400:
          description: Invalid input
        401:
          description: Unauthorized - Invalid or missing token
        403:
          description: Forbidden - Insufficient permissions
        404:
          description: Order not found
        500:
          description: Server error